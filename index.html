<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Price - Cambodian Damlung</title>
    <link rel="stylesheet" href="app.css">
    <script type="text/javascript" src="https://www.bullionvault.com/chart/bullionvaultchart.js" ></script>
</head>

<body>
    <div class="container">
        <div class="gold-icon">üá∞üá≠¬≠</div>
        <h1>Gold Price <span id="today-date"></span></h1>
<script>
    const today = new Date();
    const formattedDate =
        String(today.getMonth() + 1).padStart(2, '0') + '/' +
        String(today.getDate()).padStart(2, '0') + '/' +
        today.getFullYear();

document.getElementById('today-date').textContent = formattedDate;

</script>
        <div id="content">
            <p class="loading">Loading gold prices...</p>
        </div>
    </div>

<script>
    let currentPricePerGram = 0;
    let currentPricePerOunce = 0;

    function calculateCustomAmount() {
        const amount = parseFloat(document.getElementById('customAmount').value);
        const unit = document.getElementById('unitSelect').value;
        const customResult = document.getElementById('customResult');
        const customPrice = document.getElementById('customPrice');
        const customConversion = document.getElementById('customConversion');
        
        if (amount && amount > 0 && currentPricePerGram > 0) {
            let totalPrice = 0;
            let grams = 0;
            let unitLabel = '';
            
            // Convert to grams and calculate price based on selected unit
            switch(unit) {
                case 'gram':
                    grams = amount;
                    totalPrice = currentPricePerGram * amount;
                    unitLabel = `${amount}g`;
                    break;
                case 'ounce':
                    grams = amount * 31.1035;
                    totalPrice = currentPricePerOunce * amount;
                    unitLabel = `${amount} oz`;
                    break;
                case 'chi':
                    grams = amount * 3.75;
                    totalPrice = currentPricePerGram * grams;
                    unitLabel = `${amount} chi`;
                    break;
				case 'hon':
                    grams = amount * .375;
                    totalPrice = currentPricePerGram * grams;
                    unitLabel = `${amount} hon`;
                    break;
                case 'damlung':
                    grams = amount * 37.5;
                    totalPrice = currentPricePerGram * grams;
                    unitLabel = `${amount} damlung`;
                    break;
            }
            
            customPrice.innerHTML = `${unitLabel} = $${totalPrice.toFixed(2)}`;
            
            // Show conversions to other units
            const conversions = [];
            if (unit !== 'ounce') conversions.push(`${(grams / 31.1035).toFixed(3)} oz`);
            if (unit !== 'gram') conversions.push(`${grams.toFixed(2)} g`);
            if (unit !== 'chi') conversions.push(`${(grams / 3.75).toFixed(2)} chi`);
			if (unit !== 'hon') conversions.push(`${(grams / .375).toFixed(2)} hon`);
            if (unit !== 'damlung') conversions.push(`${(grams / 37.5).toFixed(3)} damlung`);
            
            customConversion.innerHTML = conversions.join(' | ');
            customResult.style.display = 'block';
        } else {
            customResult.style.display = 'none';
        }
    }

    async function fetchGoldPrice() {
        const contentDiv = document.getElementById('content');
        
        try {
            const response = await fetch('https://api.gold-api.com/price/XAU');
            
            if (!response.ok) {
                throw new Error('Failed to fetch gold price');
            }
            
            const data = await response.json();
            const pricePerOunce = data.price;
            currentPricePerOunce = pricePerOunce;
            
            const pricePerGram = pricePerOunce / 31.1035;
            currentPricePerGram = pricePerGram;
            const pricePerDamlung = pricePerGram * 37.5;
            const pricePerChi = pricePerGram * 3.75;
			const pricePerHon = pricePerGram * .375;
            
            contentDiv.innerHTML = `
                <div class="price-card">
                    <div class="price-label">1 DAMLUNG (37.5g)</div>
                    <div class="price-value">$${pricePerDamlung.toFixed(2)}</div>
                </div>
                
                <div class="info-grid">
                    <div class="info-box">
                        <div class="info-label">Per Ounce</div>
                        <div class="info-value">$${pricePerOunce.toFixed(2)}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Per Gram</div>
                        <div class="info-value">$${pricePerGram.toFixed(2)}</div>
                    </div>
                </div>

                <div class="info-grid">
                    <div class="info-box">
                        <div class="info-label">Per Chi (3.75g)</div>
                        <div class="info-value">$${pricePerChi.toFixed(2)}</div>
						<div class="info-label">Per Hon (.375g)</div>
                        <div class="info-value">$${pricePerHon.toFixed(2)}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Custom Calculator</div>
                        <div class="info-value" style="display: flex; flex-direction: column; gap: 8px;">
                            <input type="number" id="customAmount" placeholder="0" min="0" step="0.01"
                                   oninput="calculateCustomAmount()"
                                   style="width: 100%; padding: 5px; border: 2px solid #667eea; border-radius: 5px; text-align: center; font-size: 16px; font-weight: bold;">
                            <select id="unitSelect" onchange="calculateCustomAmount()"
                                    style="width: 100%; padding: 5px; border: 2px solid #667eea; border-radius: 5px; text-align: center; font-size: 14px; font-weight: bold; background: white; cursor: pointer;">
                                <option value="chi">Chi (3.75g)</option>
								<option value="hon">Hon (.375g)</option>
                                <option value="damlung">Damlung (37.5g)</option>
                                <option value="gram">Gram (g)</option>
                                <option value="ounce">Ounce (oz)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="customResult" style="display: none; background: #e8f5e9; border-radius: 10px; padding: 15px; margin-top: 15px; text-align: center;">
                    <div style="color: #2e7d32; font-size: 14px; margin-bottom: 8px; font-weight: 600;">Custom Calculation</div>
                    <div id="customPrice" style="color: #1b5e20; font-size: 24px; font-weight: bold;"></div>
                    <div id="customConversion" style="color: #4caf50; font-size: 10px; margin-top: 8px;"></div>
                </div>
                
                <button class="refresh-btn" onclick="fetchGoldPrice()">üîÑ Refresh Price</button>
                
                <div class="timestamp">Last updated: ${new Date().toLocaleString()}</div>
                <div class="timestamp">Note: Gold prices update continuously during market hours, from Sunday 3:00pm to Friday 2:15pm PST</div>
                
                <div id="embed" style="height: 50px; width: 100%; margin-top: 20px;"></div>
            `;
			
            // Initialize BullionVault chart after the embed div is created
            setTimeout(function() {
                var options = {
                    bullion: 'gold',
                    currency: 'USD',
                    timeframe: '1m',
                    chartType: 'line',
                    miniChartModeAxis: 'oz',
                    referrerID: 'MYUSERNAME',
                    containerDefinedSize: true,
                    miniChartMode: false,
                    displayLatestPriceLine: false,
                    switchBullion: true,
                    switchCurrency:true,
                    switchTimeframe: true,
                    switchChartType: false,
                    exportButton: false
                };
                var chartBV = new BullionVaultChart(options, 'embed');
            }, 100);
            
            // Recalculate if there was a previous value
            const existingValue = document.getElementById('customAmount')?.value;
            if (existingValue) {
                calculateCustomAmount();
            }
            
        } catch (error) {
            contentDiv.innerHTML = `
                <div class="error">
                    ‚ö†Ô∏è Error fetching gold price: ${error.message}
                    <br><br>
                    Please check your internet connection or try again later.
                </div>
                <button class="refresh-btn" onclick="fetchGoldPrice()">üîÑ Try Again</button>
            `;
        }
    }
    
    // Fetch price on page load
    fetchGoldPrice();

    // Auto-refresh every 2 minutes
    setInterval(fetchGoldPrice, 120000);
</script>
</body>
</html>
